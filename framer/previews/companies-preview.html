<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>CODED Workshop Finder</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600&family=Syne:wght@600;700;800&display=swap" rel="stylesheet" />
<style>
  :root {
    --navy: #0B1D3A;
    --blue: #2563EB;
    --blue-light: #3B82F6;
    --accent: #2563EB;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    min-height: 100vh;
    background: #FFFFFF;
    font-family: 'DM Sans', sans-serif;
    overflow-x: hidden;
  }

  /* ── Section ── */
  .finder-section {
    position: relative;
    width: 100%;
    padding: 100px 24px 120px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
  }

  /* ── Mesh gradient: soft organic blobs, not a stripe ── */
  .mesh-blob {
    position: absolute;
    border-radius: 50%;
    pointer-events: none;
    filter: blur(80px);
  }

  /* Large navy blob — center-left, very soft */
  .blob-1 {
    width: 700px; height: 700px;
    top: 50%; left: 30%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(11,29,58,0.18) 0%, transparent 70%);
  }

  /* Blue accent blob — center-right */
  .blob-2 {
    width: 500px; height: 500px;
    top: 40%; left: 65%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(37,99,235,0.10) 0%, transparent 70%);
  }

  /* Smaller navy blob — top */
  .blob-3 {
    width: 400px; height: 350px;
    top: 10%; left: 50%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(11,29,58,0.08) 0%, transparent 70%);
  }

  /* Tiny warm accent — bottom */
  .blob-4 {
    width: 350px; height: 350px;
    top: 85%; left: 40%;
    transform: translate(-50%, -50%);
    background: radial-gradient(circle, rgba(37,99,235,0.06) 0%, transparent 70%);
  }

  /* ── Card ── */
  .card {
    position: relative;
    width: 100%;
    max-width: 480px;
    min-height: 420px;
    background: rgba(255,255,255,0.65);
    backdrop-filter: blur(40px);
    -webkit-backdrop-filter: blur(40px);
    border-radius: 24px;
    padding: 36px 30px;
    border: 1px solid rgba(11,29,58,0.06);
    box-shadow:
      0 24px 64px rgba(11,29,58,0.08),
      0 0 0 1px rgba(255,255,255,0.6) inset;
    overflow: hidden;
    z-index: 1;
  }

  /* ── Sparkles ── */
  @keyframes sparkFloat {
    0%   { transform: translateY(0px) rotate(0deg) scale(1); opacity: var(--spark-o); }
    25%  { transform: translateY(-8px) rotate(12deg) scale(1.2); opacity: calc(var(--spark-o) * 1.4); }
    50%  { transform: translateY(-3px) rotate(-6deg) scale(0.85); opacity: calc(var(--spark-o) * 0.7); }
    75%  { transform: translateY(-12px) rotate(8deg) scale(1.1); opacity: var(--spark-o); }
    100% { transform: translateY(0px) rotate(0deg) scale(1); opacity: var(--spark-o); }
  }

  .sparks { position: absolute; inset: 0; pointer-events: none; overflow: hidden; z-index: 0; }
  .spark-icon { position: absolute; }

  /* ── Thinking dots ── */
  @keyframes thinkBounce {
    0%, 80%, 100% { transform: translateY(0); opacity: 0.25; }
    40% { transform: translateY(-6px); opacity: 1; }
  }

  .thinking-dots { display: flex; gap: 5px; align-items: center; padding: 16px 0 8px; }
  .thinking-dot {
    width: 7px; height: 7px; border-radius: 50%;
    background: var(--blue-light);
    animation: thinkBounce 1.1s ease-in-out infinite;
  }

  /* ── Step transitions ── */
  @keyframes stepIn {
    from { opacity: 0; transform: translateY(14px) scale(0.98); filter: blur(3px); }
    to   { opacity: 1; transform: translateY(0) scale(1); filter: blur(0); }
  }

  @keyframes chipIn {
    from { opacity: 0; transform: scale(0.85) translateY(6px); }
    to   { opacity: 1; transform: scale(1) translateY(0); }
  }

  .step { animation: stepIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards; }

  /* ── Typography ── */
  .header-tag { display: flex; align-items: center; gap: 8px; margin-bottom: 8px; }
  .header-tag span {
    font-size: 11px; font-weight: 600; letter-spacing: 0.12em;
    text-transform: uppercase; color: var(--blue);
  }
  .header-title {
    font-family: 'Syne', sans-serif; font-weight: 700; font-size: 24px;
    color: var(--navy); line-height: 1.25; margin: 0;
  }

  .step-label { color: rgba(11,29,58,0.6); font-size: 14.5px; margin: 0 0 4px; }
  .step-hint { color: rgba(11,29,58,0.3); font-size: 12px; }

  /* ── Progress bar ── */
  .progress { display: flex; gap: 5px; margin-bottom: 26px; }
  .progress-dot {
    height: 3px; flex: 1; border-radius: 99px;
    transition: background 0.5s cubic-bezier(0.22, 1, 0.36, 1);
  }

  /* ── Chips ── */
  .chips { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 12px; }

  .chip {
    padding: 9px 18px; border-radius: 100px; font-size: 13px;
    font-family: 'DM Sans', sans-serif; font-weight: 500;
    cursor: pointer; outline: none; white-space: nowrap;
    border: 1.5px solid rgba(11,29,58,0.1);
    background: rgba(255,255,255,0.7);
    color: rgba(11,29,58,0.55);
    transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    animation: chipIn 0.4s cubic-bezier(0.22, 1, 0.36, 1) backwards;
  }
  .chip:nth-child(1) { animation-delay: 0.06s; }
  .chip:nth-child(2) { animation-delay: 0.12s; }
  .chip:nth-child(3) { animation-delay: 0.18s; }
  .chip:nth-child(4) { animation-delay: 0.24s; }

  .chip:hover:not(.selected) {
    border-color: rgba(11,29,58,0.2);
    background: rgba(255,255,255,0.9);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(11,29,58,0.06);
  }
  .chip.selected {
    border-color: var(--blue);
    background: rgba(37,99,235,0.08);
    color: var(--blue);
    box-shadow: 0 2px 12px rgba(37,99,235,0.12);
  }

  /* ── Input ── */
  .text-input {
    background: rgba(255,255,255,0.7);
    border: 1.5px solid rgba(11,29,58,0.08);
    border-radius: 14px; color: var(--navy); font-size: 15px;
    font-family: 'DM Sans', sans-serif; padding: 13px 18px;
    width: 100%; outline: none;
    transition: border-color 0.3s, box-shadow 0.3s, background 0.3s;
  }
  .text-input:focus {
    border-color: var(--blue);
    background: #FFFFFF;
    box-shadow: 0 0 0 3px rgba(37,99,235,0.08);
  }
  .text-input::placeholder { color: rgba(11,29,58,0.25); }

  /* ── Buttons ── */
  .btn-primary {
    background: var(--blue); color: white; border: none;
    border-radius: 100px; padding: 12px 26px;
    font-family: 'DM Sans', sans-serif; font-weight: 600; font-size: 14px;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.22, 1, 0.36, 1);
    box-shadow: 0 4px 16px rgba(37,99,235,0.2);
  }
  .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 8px 24px rgba(37,99,235,0.3); }
  .btn-primary:disabled { opacity: 0.35; cursor: default; transform: none; box-shadow: none; }

  .btn-ghost {
    background: transparent; border: none;
    color: rgba(11,29,58,0.3); font-size: 13px;
    cursor: pointer; padding: 12px 0; font-family: 'DM Sans', sans-serif;
    transition: color 0.2s;
  }
  .btn-ghost:hover { color: rgba(11,29,58,0.5); }

  /* ── Results ── */
  .result-card {
    background: rgba(255,255,255,0.6);
    border: 1px solid rgba(11,29,58,0.06);
    border-radius: 16px; padding: 18px 20px; margin-bottom: 10px;
    animation: chipIn 0.5s cubic-bezier(0.22, 1, 0.36, 1) backwards;
    transition: border-color 0.3s, box-shadow 0.3s;
  }
  .result-card:hover {
    border-color: rgba(37,99,235,0.15);
    box-shadow: 0 8px 24px rgba(11,29,58,0.06);
  }
  .result-card:nth-child(2) { animation-delay: 0.15s; }
  .result-card:nth-child(3) { animation-delay: 0.3s; }

  .result-title {
    margin: 0 0 4px; font-family: 'Syne', sans-serif;
    font-weight: 700; color: var(--navy); font-size: 16px;
  }
  .result-desc {
    margin: 0; color: rgba(11,29,58,0.5); font-size: 13px; line-height: 1.55;
  }
  .result-badge {
    background: rgba(37,99,235,0.08); color: var(--blue);
    border-radius: 100px; padding: 3px 10px; font-size: 11px;
    font-weight: 600; white-space: nowrap; margin-left: 10px;
  }
  .result-tag {
    background: rgba(11,29,58,0.04); color: rgba(11,29,58,0.4);
    border-radius: 100px; padding: 3px 10px; font-size: 11px;
  }

  .btn-outline {
    background: transparent; border: 1px solid rgba(11,29,58,0.1);
    color: rgba(11,29,58,0.4); border-radius: 100px;
    padding: 11px 20px; font-size: 13px; cursor: pointer;
    font-family: 'DM Sans', sans-serif; transition: all 0.2s;
  }
  .btn-outline:hover { border-color: rgba(11,29,58,0.2); color: rgba(11,29,58,0.6); }

  .hidden { display: none; }

  .page-content {
    padding: 60px 24px; text-align: center;
    color: rgba(0,0,0,0.15); font-size: 14px;
  }
</style>
</head>
<body>

<div class="page-content">Your landing page content above...</div>

<section class="finder-section">
  <!-- Mesh gradient blobs -->
  <div class="mesh-blob blob-1"></div>
  <div class="mesh-blob blob-2"></div>
  <div class="mesh-blob blob-3"></div>
  <div class="mesh-blob blob-4"></div>

  <div class="card" id="finder">
    <div class="sparks" id="sparks"></div>

    <div style="position:relative; margin-bottom:28px; z-index:1;">
      <div class="header-tag">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M8 0L9.2 6.8L16 8L9.2 9.2L8 16L6.8 9.2L0 8L6.8 6.8L8 0Z" fill="#2563EB"/></svg>
        <span>CODED · Workshop Finder</span>
      </div>
      <h2 class="header-title">Find your perfect<br/>training program</h2>
    </div>

    <div class="progress" id="progress" style="position:relative;z-index:1;"></div>
    <div id="content-wrap" style="position:relative;z-index:1;">
      <div id="content"></div>
    </div>
  </div>
</section>

<div class="page-content">Your landing page content below...</div>

<script>
const ACCENT = '#2563EB';
const STEPS = ['topic','audience','duration','employees','location','company'];
let thinkingTimer = null;

const state = { step:0, topic:'', audience:[], duration:null, employees:null, iterations:null, location:null, company:'' };
let results = null, loading = false, error = '';

// Sparks
const sparkData = [
  { size:12, top:'6%',  left:'5%',  delay:'0s',   dur:'3.2s', o:0.18 },
  { size:7,  top:'14%', left:'90%', delay:'0.6s', dur:'2.8s', o:0.12 },
  { size:16, top:'72%', left:'93%', delay:'1.1s', dur:'3.6s', o:0.15 },
  { size:9,  top:'82%', left:'3%',  delay:'1.8s', dur:'2.6s', o:0.1 },
  { size:5,  top:'40%', left:'95%', delay:'0.3s', dur:'4s',   o:0.08 },
  { size:14, top:'58%', left:'2%',  delay:'2.1s', dur:'3s',   o:0.14 },
  { size:6,  top:'28%', left:'92%', delay:'0.9s', dur:'3.4s', o:0.1 },
  { size:10, top:'90%', left:'48%', delay:'1.5s', dur:'2.9s', o:0.12 },
  { size:4,  top:'3%',  left:'52%', delay:'2.4s', dur:'3.8s', o:0.08 },
];

document.getElementById('sparks').innerHTML = sparkData.map(s =>
  `<svg class="spark-icon" style="--spark-o:${s.o};top:${s.top};left:${s.left};width:${s.size}px;height:${s.size}px;color:#2563EB;opacity:${s.o};animation:sparkFloat ${s.dur} ease-in-out ${s.delay} infinite" viewBox="0 0 16 16" fill="none"><path d="M8 0L9.2 6.8L16 8L9.2 9.2L8 16L6.8 9.2L0 8L6.8 6.8L8 0Z" fill="currentColor"/></svg>`
).join('');

function showThinkingThenRender() {
  const c = document.getElementById('content');
  c.innerHTML = `<div class="thinking-dots"><div class="thinking-dot" style="animation-delay:0s"></div><div class="thinking-dot" style="animation-delay:0.15s"></div><div class="thinking-dot" style="animation-delay:0.3s"></div></div>`;
  clearTimeout(thinkingTimer);
  thinkingTimer = setTimeout(() => render(), 450);
}

function render() {
  const prog = document.getElementById('progress');
  if (state.step < STEPS.length) {
    prog.classList.remove('hidden');
    prog.innerHTML = STEPS.map((_, i) => `<div class="progress-dot" style="background:${i<=state.step?'var(--blue)':'rgba(11,29,58,0.06)'}"></div>`).join('');
  } else { prog.classList.add('hidden'); prog.innerHTML = ''; }

  const c = document.getElementById('content');

  if (state.step === 0) {
    c.innerHTML = `<div class="step">
      <p class="step-label">What do you want your team to learn? <span class="step-hint">(press Enter)</span></p>
      <input class="text-input" id="topicInput" placeholder="e.g. AI tools, data analytics, web dev..." value="${esc(state.topic)}" />
      <p style="margin:14px 0 0;color:rgba(11,29,58,0.2);font-size:12px">Or jump straight in →</p>
      <button class="btn-primary" style="margin-top:10px" onclick="advanceWithThink()">Skip & explore programs</button>
    </div>`;
    const inp = document.getElementById('topicInput'); inp.focus();
    inp.addEventListener('input', e => { state.topic = e.target.value; });
    inp.addEventListener('keydown', e => { if (e.key === 'Enter' && state.topic.trim()) advanceWithThink(); });
    return;
  }

  if (state.step === 1) {
    c.innerHTML = `<div class="step">
      <p class="step-label">Who's this training for? <span class="step-hint">pick all that apply</span></p>
      <div class="chips">${chipsHTML(['Fresh Graduates','Technical Teams','Executives','Mixed Levels'], state.audience, true)}</div>
      <button class="btn-primary" style="margin-top:20px;opacity:${state.audience.length?1:0.35}" ${state.audience.length?'':'disabled'} onclick="advanceWithThink()">Continue →</button>
    </div>`; return;
  }

  if (state.step === 2) {
    c.innerHTML = `<div class="step">
      <p class="step-label">How long can your team commit?</p>
      <div class="chips">${chipsHTML(['1 day','< 3 days','< 3 weeks','> 5 weeks'], state.duration ? [state.duration] : [], false)}</div>
    </div>`; return;
  }

  if (state.step === 3) {
    let extra = '';
    if (state.employees === '> 25 people') {
      extra = `<div style="margin-top:16px;animation:stepIn 0.4s cubic-bezier(0.22,1,0.36,1)">
        <p style="margin:0 0 8px;color:rgba(11,29,58,0.4);font-size:13px">Will this run across multiple cohorts?</p>
        <div class="chips">${chipsHTML(['Single cohort','Multiple iterations'], state.iterations ? [state.iterations] : [], false, 'iter')}</div>
      </div>`;
    }
    c.innerHTML = `<div class="step">
      <p class="step-label">How many people are enrolling?</p>
      <div class="chips">${chipsHTML(['< 8 people','12 – 15 people','> 25 people'], state.employees ? [state.employees] : [], false, 'emp')}</div>
      ${extra}
    </div>`; return;
  }

  if (state.step === 4) {
    c.innerHTML = `<div class="step">
      <p class="step-label">Where should training take place?</p>
      <div class="chips">${chipsHTML(['At CODED HQ','At our office','Flexible / Online'], state.location ? [state.location] : [], false)}</div>
    </div>`; return;
  }

  if (state.step === 5) {
    c.innerHTML = `<div class="step">
      <p class="step-label">Last one — who should we address the proposal to?</p>
      <p style="margin:0 0 12px;color:rgba(11,29,58,0.2);font-size:12px">Company name is totally optional — first name works too.</p>
      <input class="text-input" id="companyInput" placeholder="e.g. KFH, Ministry of Finance, or just Omar" value="${esc(state.company)}" />
      <div style="display:flex;gap:10px;margin-top:14px;align-items:center">
        <button class="btn-primary" onclick="advanceWithThink()">See my recommendations →</button>
        <button class="btn-ghost" onclick="advanceWithThink()">Skip</button>
      </div>
    </div>`;
    const inp = document.getElementById('companyInput'); inp.focus();
    inp.addEventListener('input', e => { state.company = e.target.value; });
    inp.addEventListener('keydown', e => { if (e.key === 'Enter') advanceWithThink(); });
    return;
  }

  if (state.step === STEPS.length && loading) {
    c.innerHTML = `<div class="step">
      <div style="display:flex;align-items:center;gap:10px;margin-bottom:14px">
        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" style="color:#2563EB;animation:sparkFloat 1.5s ease-in-out infinite"><path d="M8 0L9.2 6.8L16 8L9.2 9.2L8 16L6.8 9.2L0 8L6.8 6.8L8 0Z" fill="currentColor"/></svg>
        <span style="color:var(--blue);font-size:14px;font-weight:500">Analyzing our catalog for you...</span>
      </div>
      <div class="thinking-dots"><div class="thinking-dot" style="animation-delay:0s"></div><div class="thinking-dot" style="animation-delay:0.15s"></div><div class="thinking-dot" style="animation-delay:0.3s"></div></div>
    </div>`; return;
  }

  if (state.step === STEPS.length && !loading && error) {
    c.innerHTML = `<div class="step">
      <p style="margin:0 0 12px;color:#DC2626;font-size:14px">${esc(error)}</p>
      <button class="btn-primary" onclick="state.step=5;error='';render()">Try again</button>
    </div>`; return;
  }

  if (state.step === STEPS.length && !loading && results) {
    const recs = results.recommendations || [];
    c.innerHTML = `<div class="step">
      <div style="display:flex;align-items:center;gap:8px;margin-bottom:18px">
        <svg width="14" height="14" viewBox="0 0 16 16" fill="none"><path d="M8 0L9.2 6.8L16 8L9.2 9.2L8 16L6.8 9.2L0 8L6.8 6.8L8 0Z" fill="#2563EB"/></svg>
        <span style="color:var(--blue);font-size:13px;font-weight:600">${esc(results.greeting || 'Your top picks')}</span>
      </div>
      ${recs.map((r, i) => `<div class="result-card" style="animation-delay:${i*0.15}s">
        <div style="display:flex;justify-content:space-between;align-items:flex-start">
          <div style="flex:1"><p class="result-title">${esc(r.courseTitle)}</p><p class="result-desc">${esc(r.whyThisFits || r.description)}</p></div>
          ${i===0?`<span class="result-badge">Best Match</span>`:''}
        </div>
        <div style="display:flex;gap:6px;margin-top:10px;flex-wrap:wrap">
          ${[r.courseType,r.duration,r.tag].filter(Boolean).map(t=>`<span class="result-tag">${esc(t)}</span>`).join('')}
        </div>
      </div>`).join('')}
      ${results.note?`<p style="margin:10px 0 16px;color:rgba(11,29,58,0.35);font-size:12px;font-style:italic">${esc(results.note)}</p>`:''}
      <div style="margin-top:16px;display:flex;gap:10px;flex-wrap:wrap">
        <a href="mailto:pro@coded.com" class="btn-primary" style="display:inline-block;text-decoration:none;padding:12px 24px;font-size:13px;margin:0">Book a Consultation</a>
        <button class="btn-outline" onclick="resetAll()">Start over</button>
      </div>
    </div>`; return;
  }
}

function chipsHTML(options, selected, multi, group) {
  return options.map(opt => {
    const sel = selected.includes(opt);
    return `<button class="chip ${sel?'selected':''}" onclick="chipClick('${esc(opt)}',${multi},'${group||'default'}')">${opt}</button>`;
  }).join('');
}

function chipClick(opt, multi, group) {
  if (state.step===1) { const i=state.audience.indexOf(opt); if(i>=0) state.audience.splice(i,1); else state.audience.push(opt); render(); }
  else if (state.step===2) { state.duration=opt; advanceWithThink({duration:opt}); }
  else if (state.step===3 && group==='emp') { state.employees=opt; if(opt!=='> 25 people') advanceWithThink({employees:opt}); else render(); }
  else if (state.step===3 && group==='iter') { state.iterations=opt; advanceWithThink({iterations:opt}); }
  else if (state.step===4) { state.location=opt; advanceWithThink({location:opt}); }
}

function advanceWithThink(updates) {
  if (updates) Object.assign(state, updates);
  if (state.step < STEPS.length-1) { state.step++; showThinkingThenRender(); }
  else { state.step=STEPS.length; loading=true; error=''; render(); fetchRecommendations(); }
}

async function fetchRecommendations() {
  const WORKER_URL = '';
  if (!WORKER_URL) {
    setTimeout(() => {
      loading=false;
      results={
        greeting: state.company ? `Here's what we'd recommend for ${state.company.split(' ')[0]}` : 'Your top picks',
        recommendations: [
          { courseTitle:'AI Champions Workshop', courseType:'Workshop', duration:'4-6 Training Hours', tag:'Artificial Intelligence', whyThisFits:'A focused, high-impact session designed to get your team AI-fluent fast — perfect for the timeline and group size you described.', description:'Half-day AI literacy sprint for leadership teams.' },
          { courseTitle:'Data Analytics Sprint', courseType:'Mid Course', duration:'18-30 Training Hours', tag:'Data Science', whyThisFits:'Hands-on dashboards and data storytelling that your technical teams can apply immediately at work.', description:'Practical data storytelling & dashboards course.' },
        ],
        note:'Both programs can be delivered at your preferred location. We recommend starting with the workshop to gauge team readiness.',
      };
      render();
    }, 2000);
    return;
  }
  try {
    const res = await fetch(WORKER_URL+'/workshop-recommend', { method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({ duration:state.duration||'', teamSize:state.employees||'', multipleIterations:state.iterations==='Multiple iterations', location:state.location||'', audience:state.audience, companyName:state.company, freeText:state.topic }) });
    if(!res.ok){const d=await res.json().catch(()=>null);throw new Error(d?.error||`Request failed (${res.status})`);}
    results=await res.json(); loading=false; render();
  } catch(e){ loading=false; error=e.message||'Something went wrong'; render(); }
}

function resetAll() { state.step=0;state.topic='';state.audience=[];state.duration=null;state.employees=null;state.iterations=null;state.location=null;state.company='';results=null;loading=false;error='';render(); }
function esc(s){return String(s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#39;');}

render();
</script>
</body>
</html>
